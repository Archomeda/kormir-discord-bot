'use strict';

/* eslint-env node, mocha */
const expect = require('chai').expect;
const text = require('../../src/utils/text');


describe('text utils', () => {
    const wikiTexts = [
        {
            name: 'Fractals of the Mists',
            type: 'with bold text',
            source: "<div class=\"infobox area\">\n<p class=\"heading\">Fractals of the Mists</p>\n<div class=\"statistics\">\n</div><p class=\"image_wrapper\" style=\"padding:0 5px; text-align: center;\"><a href=\"/wiki/File:Fractals_of_the_Mists_map.jpg\" class=\"image\"><img alt=\"Fractals of the Mists map.jpg\" src=\"/images/thumb/1/11/Fractals_of_the_Mists_map.jpg/200px-Fractals_of_the_Mists_map.jpg\" width=\"200\" height=\"200\" srcset=\"/images/thumb/1/11/Fractals_of_the_Mists_map.jpg/300px-Fractals_of_the_Mists_map.jpg 1.5x, /images/thumb/1/11/Fractals_of_the_Mists_map.jpg/400px-Fractals_of_the_Mists_map.jpg 2x\" /></a><br /><small><i>Map of Fractals of the Mists</i></small></p><div class=\"wrapper\">\n<dl><dt>Levels</dt>\n<dd>1–100</dd></dl>\n<dl><dt>Type</dt>\n<dd><a href=\"/wiki/Dungeon\" title=\"Dungeon\">Dungeon</a></dd>\n<dt>Within&#160;</dt>\n<dd><a href=\"/wiki/The_Mists\" title=\"The Mists\">The Mists</a></dd>\n<dt>Connects&#160;to</dt>\n<dd><a href=\"/wiki/Lion's_Arch\" title=\"Lion's Arch\">Lion's Arch</a></dd></dl>\n<div class=\"clear\" style=\"clear: both;\"></div>\n</div>\n<p class=\"image_wrapper\" style=\"padding:0 5px; text-align:center;\"><a href=\"/wiki/File:Fractals_of_the_Mists_loading_screen.jpg\" class=\"image\"><img alt=\"Fractals of the Mists loading screen.jpg\" src=\"/images/thumb/9/93/Fractals_of_the_Mists_loading_screen.jpg/240px-Fractals_of_the_Mists_loading_screen.jpg\" width=\"240\" height=\"120\" srcset=\"/images/thumb/9/93/Fractals_of_the_Mists_loading_screen.jpg/360px-Fractals_of_the_Mists_loading_screen.jpg 1.5x, /images/thumb/9/93/Fractals_of_the_Mists_loading_screen.jpg/480px-Fractals_of_the_Mists_loading_screen.jpg 2x\" /></a><br /><small><i>Loading screen</i></small></p>\n</div>\n<blockquote style=\"padding: 0em 2em 0em 1em; margin: 1em 0em 1em 4em; border-left: 1px solid silver;\"><div style=\"position: absolute; margin-top: -0.2em; margin-left: -0.8em; font: bold 5em Times New Roman, Times, Georgie, serif; color: silver;\">“</div><div style=\"line-height: 1.53846em;\">\n<p>This portal leads to a mysterious destination. Many adventurers have entered, few have left.\n</p>\n</div><p style=\"text-align: right; font-size: 0.9em; font-style:italic; margin-top:0;\">— In-game description</p>\n</blockquote>\n<p><strong class=\"selflink\">Fractals of the Mists</strong> is a special type of <a href=\"/wiki/Dungeon\" title=\"Dungeon\">dungeon</a> that consists of an array of mini-dungeons called fractals, where each fractal has its own story and environment. Characters are <a href=\"/wiki/Dynamic_level_adjustment\" title=\"Dynamic level adjustment\">adjusted</a> to level 80 within the dungeon. The dungeon is one of the primary sources of <a href=\"/wiki/Ascended_equipment\" title=\"Ascended equipment\">ascended equipment</a> and provides materials for crafting <a href=\"/wiki/Infused_equipment\" title=\"Infused equipment\">infused equipment</a> and <a href=\"/wiki/Attuned_equipment\" title=\"Attuned equipment\">attuned equipment</a>.\n</p>",
            expected: '**Fractals of the Mists** is a special type of dungeon that consists of an array of mini-dungeons called fractals, where each fractal has its own story and environment. Characters are adjusted to level 80 within the dungeon. The dungeon is one of the primary sources of ascended equipment and provides materials for crafting infused equipment and attuned equipment.'
        },
        {
            name: 'Ascended trinket',
            type: 'with colored bold text',
            source: "<p><strong class=\"selflink\">Ascended trinkets</strong> are <a href=\"/wiki/Trinket\" title=\"Trinket\">trinkets</a> (<a href=\"/wiki/Ring\" title=\"Ring\">rings</a>, <a href=\"/wiki/Accessory\" title=\"Accessory\">accessories</a>, and <a href=\"/wiki/Amulet\" title=\"Amulet\">amulets</a>) of <span style=\"display:none\">G</span><span style=\"color:#fb3e8d;\"><b>Ascended</b></span> <a href=\"/wiki/Item#Rarity\" title=\"Item\">rarity</a>.\n</p>",
            expected: '**Ascended trinkets** are trinkets (rings, accessories, and amulets) of **Ascended** rarity.'
        },
        {
            name: 'Rox',
            type: 'with small text',
            source: "<div class=\"infobox npc\">\n<p class=\"heading\">Rox</p>\n<div class=\"wrapper\">\n<p class=\"image_wrapper\"><a href=\"/wiki/File:Rox.jpg\" class=\"image\"><img alt=\"Rox.jpg\" src=\"/images/thumb/5/5b/Rox.jpg/177px-Rox.jpg\" width=\"177\" height=\"300\" srcset=\"/images/thumb/5/5b/Rox.jpg/266px-Rox.jpg 1.5x, /images/thumb/5/5b/Rox.jpg/354px-Rox.jpg 2x\" /></a>\n</p>\n<dl><dt><a href=\"/wiki/Bestiary\" title=\"Bestiary\">Race</a></dt>\n<dd><a href=\"/wiki/Charr\" title=\"Charr\">Charr</a></dd>\n<dt><a href=\"/wiki/Profession\" title=\"Profession\">Profession</a></dt>\n<dd>Ranger  </dd>\n<dt><a href=\"/wiki/Location\" title=\"Location\">Location</a></dt>\n<dd><a href=\"/wiki/Shiverpeak_Mountains\" title=\"Shiverpeak Mountains\">Shiverpeak Mountains</a> <br /><small>(<a href=\"/wiki/Tyria\" title=\"Tyria\">Tyria</a>)</small></dd>\n<dt><a href=\"/wiki/Category:Organizations\" title=\"Category:Organizations\">Organization</a></dt>\n<dd><a href=\"/wiki/Dragon's_Watch\" title=\"Dragon's Watch\">Dragon's Watch</a> </dd></dl>\n</div>\n<table style=\"width:100%\">\n<tr>\n<td> <b>Image(s)</b>\n</td></tr>\n<tr style=\"text-align:center;\">\n<td>\n<p><a href=\"/wiki/File:Rox_(original).jpg\" class=\"image\"><img alt=\"Rox (original).jpg\" src=\"/images/thumb/d/de/Rox_%28original%29.jpg/150px-Rox_%28original%29.jpg\" width=\"150\" height=\"200\" srcset=\"/images/thumb/d/de/Rox_%28original%29.jpg/225px-Rox_%28original%29.jpg 1.5x, /images/thumb/d/de/Rox_%28original%29.jpg/300px-Rox_%28original%29.jpg 2x\" /></a>\n</p>\n<p style=\"font-size:.9em;\">Rox's original appearance</p>\n</td></tr></table>\n</div>\n<blockquote style=\"padding: 0em 2em 0em 1em; margin: 1em 0em 1em 4em; border-left: 1px solid silver;\"><div style=\"position: absolute; margin-top: -0.2em; margin-left: -0.8em; font: bold 5em Times New Roman, Times, Georgie, serif; color: silver;\">“</div><div style=\"line-height: 1.53846em;\">\n<p>If I kill <a href=\"/wiki/Scarlet\" title=\"Scarlet\" class=\"mw-redirect\">Scarlet</a>, I'm in the warband. Definitely.\n</p>\n</div><p style=\"text-align: right; font-size: 0.9em; font-style:italic; margin-top:0;\">— Rox</p>\n</blockquote>\n<p><strong class=\"selflink\">Rox</strong>, previously known as Rox Pickheart and Rox Whetstone, is now a <a href=\"/wiki/Gladium\" title=\"Gladium\">gladium</a>. She initially became one when her entire <a href=\"/wiki/Warband\" title=\"Warband\">warband</a> (and her pet <a href=\"/wiki/Devourer\" title=\"Devourer\">devourer</a>, <a href=\"/wiki/Skewer\" title=\"Skewer\">Skewer</a>) were killed in a cave-in. In early 1326 <small><a href=\"/wiki/Mouvelian_calendar\" title=\"Mouvelian calendar\">AE</a></small>, she began trials to join <a href=\"/wiki/Rytlock_Brimstone\" title=\"Rytlock Brimstone\">Rytlock Brimstone</a>'s <a href=\"/wiki/Stone_warband\" title=\"Stone warband\">Stone warband</a>, and was during this period provisionally named Rox <a href=\"/wiki/Stone_warband\" title=\"Stone warband\">Whetstone</a>. Her first assignment as Whetstone was to retake the <a href=\"/wiki/North_Nolan_Hatchery\" title=\"North Nolan Hatchery\">North Nolan Hatchery</a> from the <a href=\"/wiki/Molten_Alliance\" title=\"Molten Alliance\">Molten Alliance</a>. There she rescued a baby albino devourer, <a href=\"/wiki/Frostbite\" title=\"Frostbite\">Frostbite</a>, who became her new animal companion. She later accompanied <a href=\"/wiki/Braham\" title=\"Braham\">Braham Eirsson</a> and the <a href=\"/wiki/Vigil\" title=\"Vigil\">Vigil</a> on several raids into the Alliance's <a href=\"/wiki/Molten_Facility\" title=\"Molten Facility\">Molten Facilities</a>.\n</p>",
            expected: '**Rox**, previously known as Rox Pickheart and Rox Whetstone, is now a gladium. She initially became one when her entire warband (and her pet devourer, Skewer) were killed in a cave-in. In early 1326 AE, she began trials to join Rytlock Brimstone\'s Stone warband, and was during this period provisionally named Rox Whetstone. Her first assignment as Whetstone was to retake the North Nolan Hatchery from the Molten Alliance. There she rescued a baby albino devourer, Frostbite, who became her new animal companion. She later accompanied Braham Eirsson and the Vigil on several raids into the Alliance\'s Molten Facilities.'
        }
    ];

    wikiTexts.forEach(function (item) {
        it(`converts wiki html text to markdown${item.type} (${item.name})`, () => {
            expect(text.convertHtmlToMarkdown(item.source, 'wiki')).to.equal(item.expected);
        });
    });

    const rssTexts = [
        {
            name: 'GW2 release notes 1',
            source: 'Mark Katzbach.9084 said: 02/22/2017 &amp;#8211; February 22nd Release Notes&lt;br/&gt;Profession Skills&lt;br/&gt;General:&lt;br/&gt;A note on target-cap increases: In this balance update, we&#x27;re increasing the target cap for a select number of skills and traits. When doing this, we must consider a variety of aspects, from game health to server performance. These changes are intended for the specific purpose of improving large-group compositions and to improve their general support capability. We&#x27;ll continue to monitor these changes as time goes on and will make changes as necessary. However, we will not be looking to increase our five-target-maximum standard for player skills and will seldom (if ever) increase existing skill/trait caps.&lt;br/&gt;For the first time in a very long time, we&#x27;re changing what a specific combo finisher does. In the past, we made side steps from retaliation to a light aura that gives retaliation. In this update, we&#x27;ll be changing the blast finisher for light fields to directly remove conditions from nearby all...',
            expected: 'Mark Katzbach.9084 said: 02/22/2017 &#8211; February 22nd Release Notes<br/>Profession Skills<br/>General:<br/>A note on target-cap increases: In this balance update, we\'re increasing the target cap for a select number of skills and traits. When doing this, we must consider a variety of aspects, from game health to server performance. These changes are intended for the specific purpose of improving large-group compositions and to improve their general support capability. We\'ll continue to monitor these changes as time goes on and will make changes as necessary. However, we will not be looking to increase our five-target-maximum standard for player skills and will seldom (if ever) increase existing skill/trait caps.<br/>For the first time in a very long time, we\'re changing what a specific combo finisher does. In the past, we made side steps from retaliation to a light aura that gives retaliation. In this update, we\'ll be changing the blast finisher for light fields to directly remove conditions from nearby all...'
        },
        {
            name: 'GW2 release notes 2',
            source: 'Regina Buenaobra.6193 said: Bug Fix:&lt;br/&gt;&lt;br/&gt;	Fixed a server crash.&lt;br/&gt;',
            expected: 'Regina Buenaobra.6193 said: Bug Fix:<br/><br/> Fixed a server crash.<br/>'
        }
    ];

    rssTexts.forEach(function (item) {
        it(`converts gw2 rss feed html text to markdown (${item.name})`, () => {
            expect(text.convertHtmlToMarkdown(item.source, 'feed')).to.equal(item.expected);
        });
    });
});
